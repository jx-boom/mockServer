<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <title>高速路</title>
    <link rel="stylesheet" href="swipper.css">
</head>

<body>
    <style>
        #editGroupBox>.addBtnBox{
            background-color:#e9e1a6;
            width: 100%;
            overflow: hidden;
        }
        #editGroupBox{
            display: none;
        }
        #editGroupBox>div{
            background-color: #fff;
        }
       #editGroupBox>textarea{
         width: 100%;
         min-height: 500px;
     }
       .checkList{
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          z-index: 10;

      }
       .host{
           background-color: #fff;
           font-size: 20px;

       }
        .host #port{
            width: 50px;
        }
        .swiper-wrapper{
            height: 100% !important;

        }
        .swiper-wrapper>.swiper-slide{
            height: 100% !important;
            overflow: hidden;
        }
        .swiper-container{}
        .search-box {
            width: 100%;
            position: absolute;
            top: 0;
            height: 26px;
            z-index: 2;
        }

        .search-box .inputserVal {
            outline: none;
            border: 0;
            padding: 0;
            width: 90%;
            height: 100%;
            font-size: 15px;
            text-indent: 10px;
            background-color: transparent;
            border-bottom: 1px solid #ff5a00;

        }

        .search-box #search {
            float: right;
            margin-right: 10px;
            background-color: #ff5a00;
            font-size: 20px;
            font-weight: 800;
            width: 38px;
            text-align: center;
            border-radius: 11px;
        }

        .method {
            border: 1px solid gray;
            border-radius: 15px;
            margin: 0 5px;
            background-color: rgba(221, 255, 255, 0.51);
            padding: 0 5px;
        }

        .pp {
            background-image: url("pp.png");
            width: 66px;
            height: 66px;
            position: absolute;
            right: -57px;
            top: 70%;
            -webkit-background-size: 100% 100%;
            background-size: 100% 100%;
            /*transform:  rotateZ(-90deg) translateY(-46px) translateX(80px);*/
            animation: pp-down 1s cubic-bezier(.19, .27, .29, .95);
        }

        .hidepp {
            display: none;
        }

        .check {
            background: url(check.png);
            display: inline-block;
            float: right;
            width: 20px;
            height: 20px;
            background-size: 100% 100%;
        }

        .hide {
            display: none;
        }

        .api {
            cursor: pointer;
        }

        #editApiBox {
            display: inline-block;
            height: 60%;
            width: 100%;
        }

        #methodSelect {
            width: 72px;
            font-size: 20px;
            position: absolute;
            height: 100%;
            border-top: 2px solid grey;
        }

        #contentTypeSelect {
            width: 100%;
            font-size: 20px;
        }

        #addTip,#addGroup {
            float: left;
            font-size: 20px;
            font-weight: 800;
            background-color: #ff5a00;
            width: 30px;
            text-align: center;
            border-radius: 15px;
            cursor: pointer;
        }

        #urlBox {
            width: 100%;
            position: relative;
        }

        #url {
            text-indent: 72px;
        }

        #urlBox input {
            border-top-left-radius: 10px;
            width: 100%;
            padding-top: 2px;
            padding-bottom: 2px;
            font-size: 20px;
            border-left: 0;
            outline: none;
        }

        #logic {
            width: 100%;
            height: 100px;
            font-size: 20px;
        }

        .swiper-slide textarea {
            width: 100%;
            height: 100%;
            font-size: 20px;
        }

        .container {
            width: 100%;
            height: 50%;
        }

        .swiper1 {
            width: 100%;
            background-color: #e9e1a6;
        }

        .swiper1 .selected {
            color: #ec5566;
            border-bottom: 2px solid #ec5566;
        }

        .swiper1 .swiper-slide {
            text-align: center;
            font-size: 16px;
            height: 24px;
            /* Center slide text vertically */
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
            cursor: pointer;
        }

        .swiper2 {
            width: 100%;
            border-bottom-left-radius: 10px;
            width: 100%;
            border-bottom-left-radius: 10px;
            border-bottom: 3px solid #e9e1a64d;
            border-left: 3px solid #e9e1a64d
        }

        .swiper2 .swiper-slide {
            height: calc(100vh - 50px);
            background-color: #c3bace;
            color: #fff;
            text-align: center;
            box-sizing: border-box !important;
            overflow-x: hidden !important;
        }

        /*//////*/

        .right {
            width: 65%;
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            padding-top: 5%;
        }

        .gt {
            background: url(gt.png);
            display: inline-block;
            width: 15px;
            height: 15px;
            background-size: 100% 100%;
            margin-left: 10px;
        }

        #sub {
            position: absolute;
            background-color: red;
            z-index: 8;
            top: 85%;
            height: 68px;
            border-radius: 14px;
            opacity: 0;
            cursor: pointer;
            width: 50px;
        }

        #myfiles {
            position: absolute;
            left: 30%;
            top: 74%;
            height: 20px;
            border-radius: 31px;
            vertical-align: top;
            cursor: pointer;
        }

        .uploadNurse::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 14px;
            background-color: #a8ff00;
            animation: nurse-change 1s ease-out infinite;
        }
      #Grouplist{
        display: none;
       }
        #list ,#Grouplist{
            position: absolute;
            top: 20px;
            left: 0;
            width: 87%;
            z-index: 2;
            height: 89%;
            overflow-y: scroll;
        }

        #list li {
            width: 100%;
            word-break: break-all;
        }

        #apilist {
            width: 32%;
            background-color: #e9e1a6;
            height: 98%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            border-bottom-right-radius: 18px
        }

        #apilist::before {
            content: '';
            width: 102%;
            height: 100%;
            top: 10px;
            left: 0;
            background-color: #e9e1a64d;
            display: block;
            position: relative;
            z-index: 1;
            border-radius: 15px;
        }

        #apilist::after {
            content: '';
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: #e9e1a6;
            display: block;
            position: absolute;
            z-index: 1;
            border-radius: 7px;
        }

        html,
        body {
            overflow: hidden;
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center center;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -ms-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            background-color: #620ca9;
            background-image: url("http://svgshare.com/i/17a.svg");
            background-size: fill;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .dog {
            position: absolute;
            top: 73%;
            width: 50px;
            height: 40px;
            z-index: 200;
            left: 60%;
        }

        .heart {
            position: absolute;
            width: 6%;
            height: 7%;
            background-color: #ff4ea0;
            border-bottom-right-radius: 23%;
            opacity: 0;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
            display: none;
        }




        .body {
            position: absolute;
            width: 100%;
            height: 50%;
            background-color: #f79e38;
            border-top-right-radius: 17% 40%;
            border-top-left-radius: 25%;
            border-bottom-right-radius: 5% 13%;
            border-bottom-left-radius: 30% 40%;
            z-index: 3;
        }

        .cheast {
            position: absolute;
            width: 45%;
            height: 100%;
            background-color: #fff;
            border-top-right-radius: 17% 40%;
            border-top-left-radius: 25%;
            border-bottom-right-radius: 40% 40%;
            border-bottom-left-radius: 40% 40%;
            z-index: 4;
        }

        .cheast:after,
        .cheast:before {
            position: absolute;
            content: '';
            width: 7%;
            height: 55%;
            border-radius: 39%;
            background-color: #fff;
        }

        .cheast:after {
            top: 36%;
            left: 3%;
            -webkit-transform: rotate(-1deg);
            transform: rotate(-1deg);
        }

        .cheast:before {
            top: 19%;
            left: -4%;
        }

        .head {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 4;
            -webkit-animation: dog-head 1s ease-out infinite;
            animation: dog-head 1s ease-out infinite;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
            -webkit-animation-direction: alternate;
            animation-direction: alternate;
        }
        .nose,
        .uploadNurse {
            position: absolute;
            width: 50px;
            height: 68px;
            z-index: 7;
            top: 85%;
            border-radius: 14px;
            background-color: red;
        }
    </style>

    <div id="backGround">
        <button id="sub" type="submit">132</button>
        <div id="dogNurse" class="nose"></div>
    </div>
    <div id="apilist">
       <div class="checkList"> <button id="checkApi">api</button>  <button id="checkGroup">group</button></div>
        <!--<div class="search-box">-->
            <!--<input type="text" class="inputserVal">-->
            <!--<div id="search">搜</div>-->
        <!--</div>-->
        <ul id="list"></ul>
        <ul id="Grouplist"></ul>
    </div>

    <!--<div class="left"></div>-->
    <div class="right">
        <div class="host">
            <span>hostname</span>
            <input type="text" id="hostname">
            <span>port</span>
            <input id="port" type="number">

            <button id="sethost">确定</button>
        </div>
      <div id="editGroupBox">
        <div>  <span>群组名称</span> <input type="text" id="groupName"> </div>
         <div class="addBtnBox">
             <i id="addGroup">提交</i>
         </div>
          <textarea name="" id="groupVal" cols="30" rows="10" id="groupContent"></textarea>
      </div>


        <div id="editApiBox">

            <div id="urlBox">
                <select id="methodSelect">
                    <option value="post">post</option>
                    <option value="get">get</option>
                    <option value="delete">delete</option>
                    <option value="patch">patch</option>
                    <option value="put">put</option>

                </select>
                <input id="url" type="text">
            </div>

            <select id="contentTypeSelect">
                <option value="application/x-www-form-urlencoded">application/x-www-form-urlencoded</option>
                <option value="text/xml">text/xml</option>
                <option value="application/json">application/json</option>
                <option value="multipart/form-data">multipart/form-data</option>
            </select>


            <textarea name="" id="logic" cols="30" rows="10"></textarea>
            <div class="container">
                <div class="swiper-container swiper1">
                    <div class="swiper-wrapper" id="controllTip">
                        <i id="addTip">提交</i>
                        <div class="swiper-slide">菜单 1</div>
                        <div class="swiper-slide">菜单 2</div>
                        <div class="swiper-slide">菜单 3</div>
                        <div class="swiper-slide">菜单 4</div>

                    </div>
                </div>
                <!-- swiper2 -->
                <div class="swiper-container swiper2">
                    <div class="swiper-wrapper" id="tipList">
                        <div class="swiper-slide swiper-no-swiping">
                            <textarea rows="4" id="c1" cols="50" name="comment"></textarea>
                        </div>
                        <div class="swiper-slide swiper-no-swiping">
                            <textarea rows="4" id="c2" cols="50" name="comment"></textarea>
                        </div>
                        <div class="swiper-slide swiper-no-swiping">
                            <textarea rows="4" id="c3" cols="50" name="comment"></textarea>
                        </div>
                        <div class="swiper-slide swiper-no-swiping">
                            <textarea rows="4" id="c4" cols="50" name="comment"></textarea>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div>
            <!--<input type="text" placeholder="url">-->


            <input type="file" id="myfiles" name="json">



        </div>
    </div>
</body>
<script src="socket.io.js"></script>
<script src="jquery.js"></script>
<script src="swipper.js"></script>
<script src="./Ip.js"> </script>
<script>
    var list;
    var ip = getIp();
    $('#sethost').click(function () {
        var hostname= $('#hostname').val()
        var port= $('#port').val();
        function isValidIP(ip) {
            var reg = /^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/
            return reg.test(ip);
        }
         if(!isValidIP(hostname)){
             alert('格式错误')
            return
  }

        $.post('http://' + ip + ':8088/setHost', { hostname:hostname, port:port}, function (res, status) {
            if (status != 'success') {
                $("#pp").attr("class", "pp");
                return
            }
           alert('更新服务器地址'+hostname+':'+port);
            $("#dogNurse").attr("class", "nose");

        })
    })

    $('#addTip').click(function () {
        // 睡醒之后看
        var list = $('#tipList').children();
        var content = [];
        var contiat= true;
        try {
            for (var x = 0, l = list.length; x < l; x++) {
                var val = $(list[x]).children().val();
                if (val !== '') {

                    content.push(val)
                }
            }
        }
        catch (err) {
            console.log(err);
            alert('格式错误');
            contiat= false;
        }
        if(!contiat){
            return
        }


        var sim = {
            "href": $('#url').val(),
            "logic": $('#logic').val(),
            "contentType": $('#contentTypeSelect').val(),
            "method": $('#methodSelect').val(),
            "content": content
        };
        $("#dogNurse").attr("class", "uploadNurse");
        sim = JSON.stringify(sim);

        //ip
        $.ajax({
            type: 'POST',
            url: "http://" + ip + ":8088/editApi",
            data: sim,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (re, status) {
                if (status != 'success') {
                    $("#pp").attr("class", "pp");
                    return
                }
                socket.emit("changeList", { ip });
                $("#dogNurse").attr("class", "nose");

            }
        });
    });
    $('#sub').mouseover(function () {
        $('.heart').css("display", "block");
    });
    $('#sub').mouseout(function () {
        $('.heart').css("display", "none");
    });

    $("#sub").click(function () {
        $("#dogNurse").attr("class", "uploadNurse");
        if ($("#pp").hasClass("pp")) {
            $("#pp").attr("class", "hidepp");
            $("#dogNurse").attr("class", "nose");
            return
        }

        var formData = new FormData();
        var files = document.getElementById("myfiles").files;
        formData.enctype = "multipart/form-data";
        var fileArray = [].slice.call(files, 0);//类数组转换为数组
        fileArray.forEach(function (file) {
            formData.append("myfile", file);//循环遍历把文件对象插到formData对象上
        });
        var xhr = new XMLHttpRequest();
        xhr.open("post", "http://" + ip + ":8088/upFile", true);//发送post请求到/upload


        xhr.onload = function (e) {
            if (this.status == 200) {

                list = JSON.parse(e.target.response).list
                renderApiList(JSON.parse(e.target.response).list, 'c')
                $("#dogNurse").attr("class", "nose");
            } else {
                $("#pp").attr("class", "pp");
            }
        };
        xhr.send(formData);




    });
    var checkDom;
    function renderApiList(json, b) {
        var DOM = '';
        for (var api in json) {
            DOM += '<li   api=' + api + '  class=\'api\'><b class="text">' + json[api]['realName'] + '</b> <span class="method">' + json[api]['method'] + '</span><i class="gt"></i> <b class="check hide"></b></li>'
        };
        $("#list").html(DOM)


    }
    function renderGroupList(arr, b) {
        var DOM = '';
        for (var api of arr) {
            DOM += '<li   api=' + api + '  class=\'api\'><b class="text">' + api+ '</b> <i class="gt"></i> </li>'
        };
        $("#Grouplist").html(DOM)


    }
    $('#list').on('click', '.gt', function (e) {
        var apiName = $(e.target).parent(".api").attr("api");
        $("#dogNurse").attr("class", "uploadNurse");

        $.post('http://' + ip + ':8088/deleteApi', { apiName }, function (res, status) {
            if (status != 'success') {
                $("#pp").attr("class", "pp");
                return
            }
            socket.emit("changeList", { ip });
            $("#dogNurse").attr("class", "nose");

        })
    });
    $('#list').on('click', '.text', function (e) {
        var api = $(e.target).parent(".api").attr("api");
        var method = $(e.target).parent(".api").children('.method').html();
        if (checkDom) {
            checkDom.addClass("hide");
        }
        checkDom = $(e.target).children('b');
        $(e.target).children('b').removeClass("hide");

        $("#dogNurse").attr("class", "uploadNurse");
        $.get("http://" + ip + ":8088/apiContent", { api, method },
            function (result, status) {

                if (status != 'success') {
                    $("#pp").attr("class", "pp");
                    return
                }

                $("#dogNurse").attr("class", "nose");
                result = JSON.parse(result);
                result = result.api;
                $('#url').val(result.realName);
                $('#logic').val(result.logic);
                $('#contentTypeSelect').val(result.contentType);
                $('#methodSelect').val(result.method);
                if (result == []) {
                    return
                }
                for (var i = 0; i < 4; i++) {
                    var dom = '#c' + (i + 1);
                    $(dom).val('');
                }

                if (!result.content) {
                    result.content = [];
                }


                for (var x = 0, l = result.content.length; x < l; x++) {
                    if (x <= 3) {
                        var dom = '#c' + (x + 1);
                        $(dom).val(JSON.stringify(result.content[x]));
                    }
                }

            })
    });
    $('#search').on('click', function (e) {
        var renderList = {};
        for (var api in list) {
            if (api.indexOf($('.inputserVal').val()) != -1) {
                renderList[api] = list[api];
            }
        }
        renderApiList(renderList, 'f')

    })

</script>
<script>
    var ip = getIp();
    $(function () {
        function setCurrentSlide(ele, index) {
            $(".swiper1 .swiper-slide").removeClass("selected");
            ele.addClass("selected");
            //swiper1.initialSlide=index;
        }

        var swiper1 = new Swiper('.swiper1', {
            slidesPerView: 5.5,
            paginationClickable: true,
            spaceBetween: 10,
            freeMode: true,
            loop: false,
            onTab: function (swiper) {
                var n = swiper1.clickedIndex;
            }
        });
        swiper1.slides.each(function (index, val) {
            var ele = $(this);
            ele.on("click", function () {
                setCurrentSlide(ele, index);
                swiper2.slideTo(index, 500, false);
                //mySwiper.initialSlide=index;
            });
        });

        var swiper2 = new Swiper('.swiper2', {
            //freeModeSticky  设置为true 滑动会自动贴合
            direction: 'horizontal',//Slides的滑动方向，可设置水平(horizontal)或垂直(vertical)。
            loop: false,
            //					effect : 'fade',//淡入
            //effect : 'cube',//方块
            //effect : 'coverflow',//3D流
            //					effect : 'flip',//3D翻转
            autoHeight: true,//自动高度。设置为true时，wrapper和container会随着当前slide的高度而发生变化。
            onSlideChangeEnd: function (swiper) {  //回调函数，swiper从一个slide过渡到另一个slide结束时执行。
                var n = swiper.activeIndex;
                setCurrentSlide($(".swiper1 .swiper-slide").eq(n), n);
                swiper1.slideTo(n, 500, false);
            }
        });


        $("#dogNurse").attr("class", "uploadNurse");

        $.get('http://' + ip + ':8088/apiList', function (res, status) {
            if (status != 'success') {
                $("#pp").attr("class", "pp");
                return
            }

            $("#dogNurse").attr("class", "nose");
            list = JSON.parse(res);
            renderApiList(JSON.parse(res), 'g')
        });
        $.get('http://' + ip + ':8088/groupList', function (res, status) {
            if (status != 'success') {
                $("#pp").attr("class", "pp");
                return
            }
            $("#dogNurse").attr("class", "nose");
            list = JSON.parse(res);
            renderGroupList(JSON.parse(res), 'g')
        })
    });

</script>
<script>
    var ip = getIp();
    socket = io.connect('ws://' + ip + ':8088');
    socket.on("changeList", function (reqIp) {
        console.log(reqIp.ip);
        console.log('其他更新');
        $.get('http://' + ip + ':8088/apiList', function (res) {
            list = JSON.parse(res);
            renderApiList(JSON.parse(res))
        })

    });
</script>
<script>
    $('#checkApi').click(function () {
        $('#Grouplist').css("display", "none");
        $('#editGroupBox').css("display", "none");
        $('#list').css("display", "block");
        $('#editApiBox').css("display", "block");
    });
    $('#checkGroup').click(function () {
        $('#list').css("display", "none");
        $('#editApiBox').css("display", "none");
        $('#Grouplist').css("display", "block");
        $('#editGroupBox').css("display", "block");
        // $('.search-box').css("display", "none");
    });
    $('#Grouplist').click(function (e) {
       var groupKey=   e.target.innerText;
        if(e.target.className=='gt'){
            groupKey=e.target.parentNode.childNodes[0].innerText
           $.post('http://' + ip + ':8088/deleteGroup', { groupKey:groupKey},function (res, status) {
               if (status != 'success') {
                   $("#pp").attr("class", "pp");
                   return
               }
               renderGroupList(JSON.parse(res), 'g')
           })
       }
       else{
           $.post('http://' + ip + ':8088/getGroupContent', { groupKey:groupKey},function (res, status) {
               if (status != 'success') {
                   $("#pp").attr("class", "pp");
                   return
               }
               $("#groupName").val(groupKey)
               $("#editGroupBox>textarea").val(res)
           })
       }



    });
    $('#addGroup').click(function (e) {
       var groupKey=   $('#groupName').val();
       var groupVal=   $('#groupVal').val();
        try {

            var result =typeof JSON.parse(groupVal);
            if(result !='object'||groupKey.length<=1){
                alert('格式错误')
                return
            }
            $.post('http://' + ip + ':8088/addGroup', { groupKey:groupKey,groupVal:groupVal},function (res, status) {
                if (status != 'success') {
                    $("#pp").attr("class", "pp");
                    return
                }
                renderGroupList(JSON.parse(res), 'g')
            })
        }
        catch (e) {
            alert('格式错误')
        }




    })
</script>
</html>